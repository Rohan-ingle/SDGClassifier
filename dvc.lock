schema: '2.0'
stages:
  data_preprocessing:
    cmd: python src/data/preprocess.py
    deps:
    - path: data/raw/osdg-community-data-v2024-04-01.csv
      hash: md5
      md5: 26627ce342bc1de474be21d9a9b80536
      size: 30208569
      isexec: true
    - path: params.yaml
      hash: md5
      md5: 7d10fcba56f05d6a787c83c2f5a51b84
      size: 1528
      isexec: true
    - path: src/data/preprocess.py
      hash: md5
      md5: e2e6bc7950481561b3cb5a267b3ae5bd
      size: 19089
      isexec: true
    params:
      params.yaml:
        data.random_state: 42
        data.test_size: 0.2
        data.val_size: 0.1
        preprocessing.lowercase: true
        preprocessing.max_df: 0.95
        preprocessing.max_features: 10000
        preprocessing.min_df: 5
        preprocessing.ngram_range:
        - 1
        - 2
        preprocessing.remove_stopwords: true
    outs:
    - path: data/processed/X_test.pkl
      hash: md5
      md5: 993b0652c0830cfa437739311242b421
      size: 4872358
      isexec: true
    - path: data/processed/X_train.pkl
      hash: md5
      md5: a6a104915e5b71337928073b6d028e7d
      size: 17177428
      isexec: true
    - path: data/processed/X_val.pkl
      hash: md5
      md5: 37abab8c6991f6ee36ac1f08cdb63128
      size: 2442754
      isexec: true
    - path: data/processed/data_stats.json
      hash: md5
      md5: efe2f9340d7ad4a886eb29879852382f
      size: 1910
      isexec: true
    - path: data/processed/label_encoder.pkl
      hash: md5
      md5: 62965910f78c787e472fa24ead2ceea7
      size: 370
      isexec: true
    - path: data/processed/vectorizer.pkl
      hash: md5
      md5: 406b32273c8521085e87ec8144468ae2
      size: 396299
      isexec: true
    - path: data/processed/y_test.pkl
      hash: md5
      md5: 9ce73a144d415e28b11383286ecae073
      size: 69001
      isexec: true
    - path: data/processed/y_train.pkl
      hash: md5
      md5: 07922ecfa7c668d66fef11c77ce7c44b
      size: 241097
      isexec: true
    - path: data/processed/y_val.pkl
      hash: md5
      md5: de806dd053ed2029e74e156198b12c12
      size: 34576
      isexec: true
  train_model:
    cmd: python src/models/train.py
    deps:
    - path: data/processed/X_train.pkl
      hash: md5
      md5: a6a104915e5b71337928073b6d028e7d
      size: 17177428
      isexec: true
    - path: data/processed/X_val.pkl
      hash: md5
      md5: 37abab8c6991f6ee36ac1f08cdb63128
      size: 2442754
      isexec: true
    - path: data/processed/label_encoder.pkl
      hash: md5
      md5: 62965910f78c787e472fa24ead2ceea7
      size: 370
      isexec: true
    - path: data/processed/vectorizer.pkl
      hash: md5
      md5: 406b32273c8521085e87ec8144468ae2
      size: 396299
      isexec: true
    - path: data/processed/y_train.pkl
      hash: md5
      md5: 07922ecfa7c668d66fef11c77ce7c44b
      size: 241097
      isexec: true
    - path: data/processed/y_val.pkl
      hash: md5
      md5: de806dd053ed2029e74e156198b12c12
      size: 34576
      isexec: true
    - path: params.yaml
      hash: md5
      md5: 7d10fcba56f05d6a787c83c2f5a51b84
      size: 1528
      isexec: true
    - path: src/models/train.py
      hash: md5
      md5: 03a3578d2d26856fccc8c2c17d8bc7b6
      size: 10512
      isexec: true
    params:
      params.yaml:
        model.algorithm: random_forest
        model.class_weight: balanced
        model.max_depth: 10
        model.min_samples_leaf: 2
        model.min_samples_split: 5
        model.n_estimators: 100
        neural_network.batch_size: 32
        neural_network.dropout_rate: 0.3
        neural_network.epochs: 50
        neural_network.hidden_layers:
        - 128
        - 64
        - 32
        neural_network.learning_rate: 0.001
    outs:
    - path: models/model.pkl
      hash: md5
      md5: f500545fd1df40afd0cee90cede24ba2
      size: 3198730
      isexec: true
    - path: models/training_metrics.json
      hash: md5
      md5: 442d00f5d8f2008040d3e6b8562453f6
      size: 138805
      isexec: true
  evaluate_model:
    cmd: python src/evaluation/evaluate.py
    deps:
    - path: data/processed/X_test.pkl
      hash: md5
      md5: 993b0652c0830cfa437739311242b421
      size: 4872358
      isexec: true
    - path: data/processed/label_encoder.pkl
      hash: md5
      md5: 62965910f78c787e472fa24ead2ceea7
      size: 370
      isexec: true
    - path: data/processed/vectorizer.pkl
      hash: md5
      md5: 406b32273c8521085e87ec8144468ae2
      size: 396299
      isexec: true
    - path: data/processed/y_test.pkl
      hash: md5
      md5: 9ce73a144d415e28b11383286ecae073
      size: 69001
      isexec: true
    - path: models/model.pkl
      hash: md5
      md5: f500545fd1df40afd0cee90cede24ba2
      size: 3198730
      isexec: true
    - path: params.yaml
      hash: md5
      md5: 7d10fcba56f05d6a787c83c2f5a51b84
      size: 1528
      isexec: true
    - path: src/evaluation/evaluate.py
      hash: md5
      md5: 4f517c62a229ac0229490294378f6e28
      size: 12757
      isexec: true
    params:
      params.yaml:
        evaluation.classification_threshold: 0.5
        evaluation.cv_folds: 5
        evaluation.scoring_metrics:
        - accuracy
        - f1_macro
        - precision_macro
        - recall_macro
    outs:
    - path: metrics/classification_report.txt
      hash: md5
      md5: 301cc864f38fc4c2c30c0337105699ad
      size: 2537
      isexec: true
    - path: metrics/confusion_matrix.png
      hash: md5
      md5: 6adc376ad15e74f367fd12b29b106b70
      size: 436297
      isexec: true
    - path: metrics/evaluation_results.json
      hash: md5
      md5: a79aecb560b2abe6c259bf28d8db4118
      size: 8847
      isexec: true
    - path: metrics/feature_importance.png
      hash: md5
      md5: 8dfd41d1a1939be0529ce028bbea2b7a
      size: 137211
      isexec: true
  model_validation:
    cmd: python src/evaluation/validate.py
    deps:
    - path: data/processed/X_val.pkl
      hash: md5
      md5: 37abab8c6991f6ee36ac1f08cdb63128
      size: 2442754
      isexec: true
    - path: data/processed/label_encoder.pkl
      hash: md5
      md5: 62965910f78c787e472fa24ead2ceea7
      size: 370
      isexec: true
    - path: data/processed/vectorizer.pkl
      hash: md5
      md5: 406b32273c8521085e87ec8144468ae2
      size: 396299
      isexec: true
    - path: data/processed/y_val.pkl
      hash: md5
      md5: de806dd053ed2029e74e156198b12c12
      size: 34576
      isexec: true
    - path: models/model.pkl
      hash: md5
      md5: f500545fd1df40afd0cee90cede24ba2
      size: 3198730
      isexec: true
    - path: params.yaml
      hash: md5
      md5: 7d10fcba56f05d6a787c83c2f5a51b84
      size: 1528
      isexec: true
    - path: src/evaluation/validate.py
      hash: md5
      md5: b7042fd41cfd103fb460342fc02cfe27
      size: 4338
      isexec: true
    params:
      params.yaml:
        evaluation.scoring_metrics:
        - accuracy
        - f1_macro
        - precision_macro
        - recall_macro
    outs:
    - path: metrics/validation_report.txt
      hash: md5
      md5: 6b32045be4403d79bbf42d1a8ed2952d
      size: 266
      isexec: true
    - path: metrics/validation_results.json
      hash: md5
      md5: 0a7bcb463810a784017a886958f5dbce
      size: 3179
      isexec: true
  export_model:
    cmd: python src/models/export.py
    deps:
    - path: data/processed/label_encoder.pkl
      hash: md5
      md5: 62965910f78c787e472fa24ead2ceea7
      size: 370
      isexec: true
    - path: data/processed/vectorizer.pkl
      hash: md5
      md5: 406b32273c8521085e87ec8144468ae2
      size: 396299
      isexec: true
    - path: metrics/evaluation_results.json
      hash: md5
      md5: a79aecb560b2abe6c259bf28d8db4118
      size: 8847
      isexec: true
    - path: models/model.pkl
      hash: md5
      md5: f500545fd1df40afd0cee90cede24ba2
      size: 3198730
      isexec: true
    - path: params.yaml
      hash: md5
      md5: 7d10fcba56f05d6a787c83c2f5a51b84
      size: 1528
      isexec: true
    - path: src/models/export.py
      hash: md5
      md5: a91bf404f1dd2e72ee57fd0c11ab8db4
      size: 7946
      isexec: true
    params:
      params.yaml:
        deployment.model_name: sdg_classifier
        deployment.model_version: v1.0.0
    outs:
    - path: models/final_model.pkl
      hash: md5
      md5: 414fbf2758da3dc45b9ad4531021539f
      size: 3207817
      isexec: true
    - path: models/inference_pipeline.pkl
      hash: md5
      md5: 4658aa89e6d5eb18a2d43664fe634cb9
      size: 3595243
      isexec: true
    - path: models/model_metadata.json
      hash: md5
      md5: ece56f98da463cdeb97774412b43e016
      size: 1625
      isexec: true
